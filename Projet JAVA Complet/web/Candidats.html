<!-- =========================
     Formulaire de recherche + tri
     ========================= -->
<form method="get" action="Candidats" class="search-sort-form">
    <!-- Recherche -->
    <input type="text" name="q" placeholder="Rechercher un candidat..." 
           value="${param.q != null ? param.q : ''}">

    <!-- Tri -->
    <select name="sort">
        <option value="">-- Trier par --</option>
        <option value="nom" ${param.sort == 'nom' ? 'selected' : ''}>Nom</option>
        <option value="prenom" ${param.sort == 'prenom' ? 'selected' : ''}>Prénom</option>
        <option value="email" ${param.sort == 'email' ? 'selected' : ''}>Email</option>
        <option value="status" ${param.sort == 'status' ? 'selected' : ''}>Statut</option>
        <option value="poste" ${param.sort == 'poste' ? 'selected' : ''}>Poste visé</option>
    </select>

    <button type="submit">Appliquer</button>
</form>

<!-- =========================
     Liste des candidats
     ========================= -->
<c:forEach var="candidat" items="${candidats}">
<div class="candidate-card">
  
  <!-- En-tête du candidat -->
  <div class="candidate-header">
    <div class="candidate-avatar">
      <c:choose>
        <c:when test="${not empty candidat.photo}">
          <img src="${candidat.photo}" alt="Photo de ${candidat.prenom}">
        </c:when>
        <c:otherwise>
          ${fn:toUpperCase(fn:substring(candidat.prenom,0,1))}
          ${fn:toUpperCase(fn:substring(candidat.nom,0,1))}
        </c:otherwise>
      </c:choose>
    </div>

    <div>
      <h2>${candidat.prenom} ${candidat.nom}</h2>
      <p>${candidat.poste}</p>
    </div>
  </div>

  <!-- Infos principales -->
  <p>Email : ${candidat.email}</p>
  <p>Compétences : ${candidat.competences}</p>

  <!-- Bouton CV -->
  <c:if test="${not empty candidat.cv}">
    <a href="${candidat.cv}" target="_blank" class="btn btn-cv">Voir le CV</a>
  </c:if>

  <!-- Changement de statut -->
  <form method="post" action="update_status" class="status-form">
    <input type="hidden" name="id" value="${candidat.id}">
    <select name="status" class="status-select">
      <option value="en_attente" ${candidat.status == 'en_attente' ? 'selected' : ''}>En attente</option>
      <option value="accepte" ${candidat.status == 'accepte' ? 'selected' : ''}>Accepté</option>
      <option value="refuse" ${candidat.status == 'refuse' ? 'selected' : ''}>Refusé</option>
    </select>
    <button type="submit" class="btn btn-status">Mettre à jour</button>
  </form>

  <!-- Suppression -->
  <form method="post" action="delete_candidate" class="delete-form">
    <input type="hidden" name="id" value="${candidat.id}">
    <button type="submit" class="btn btn-delete">Supprimer</button>
  </form>

</div>
</c:forEach>
